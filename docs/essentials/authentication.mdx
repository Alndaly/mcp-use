---
title: "Authentication"
description: "Authentication for MCP-use"
icon: "key"
---

# Authentication

mcp-use supports OAuth 2.0 authentication for MCP servers that require it. This includes automatic Dynamic Client Registration (DCR) for servers that support it.

## Overview

When connecting to an MCP server that requires authentication, mcp-use will:
1. Attempt to use existing access tokens if available
2. Try Dynamic Client Registration if no client_id is provided
3. Guide you through the OAuth flow to obtain new tokens
4. Store tokens securely for future use

## Basic OAuth Configuration

### With Pre-registered Client

If you've already registered an OAuth application with the server:

```python
from mcp_use import MCPClient

config = {
    "mcpServers": {
        "myserver": {
            "url": "https://mcp.example.com/sse",
            "auth": {
                "client_id": "your-registered-client-id",
                "client_secret": "your-client-secret",  # Optional, for confidential clients
                "scope": "read write"  # Optional, specify required scopes
            }
        }
    }
}

client = MCPClient(config=config)
```

### With Dynamic Client Registration

For servers that support Dynamic Client Registration (RFC 7591), you can omit the client_id:

```python
config = {
    "mcpServers": {
        "myserver": {
            "url": "https://mcp.example.com/sse",
            "auth": {
                # No client_id needed - will use Dynamic Client Registration
                "scope": "read write"  # Optional
            }
        }
    }
}
```

On first run, mcp-use will:
1. Automatically register a new OAuth client with the server
2. Store the registration for future use
3. Proceed with the OAuth flow

## OAuth Flow

When authentication is needed:

1. **Browser Opens**: Your default browser will open to the authorization page
2. **Grant Access**: Review and approve the requested permissions
3. **Automatic Redirect**: You'll be redirected to a local callback URL
4. **Token Storage**: Access tokens are stored securely in `~/.mcp_use/tokens/`

## Token Storage

Tokens and client registrations are stored in:
- **Access Tokens**: `~/.mcp_use/tokens/{server_domain}.json`
- **Client Registrations**: `~/.mcp_use/tokens/registrations/{server_domain}_registration.json`

## Redirect URIs

### For Dynamic Client Registration

mcp-use registers multiple redirect URIs to ensure compatibility:
- `http://127.0.0.1:8080/callback`
- `http://127.0.0.1:8081/callback`
- `http://127.0.0.1:8082/callback`
- `http://127.0.0.1:8083/callback`
- `http://127.0.0.1:8084/callback`

The client will try to use one of these registered ports during the OAuth flow.

### For Manual Registration

When manually registering your OAuth application, you can use:
- **Dynamic Port**: `http://127.0.0.1:{port}/callback` (any port)
- **Fixed Port**: One of the ports listed above
- **Wildcard**: Some providers support `http://127.0.0.1:*/callback`

## Examples

### Linear MCP Server

```python
from mcp_use import MCPClient

# Uses Dynamic Client Registration
config = {
    "mcpServers": {
        "linear": {
            "url": "https://mcp.linear.app/sse",
            "auth": {}  # Empty auth config triggers DCR
        }
    }
}

client = MCPClient(config=config)
sessions = await client.create_all_sessions()
```

### Asana MCP Server

```python
config = {
    "mcpServers": {
        "asana": {
            "url": "https://mcp.asana.com/sse",
            "auth": {}  # Uses DCR
        }
    }
}
```

### With Pre-registered Client

```python
config = {
    "mcpServers": {
        "github": {
            "url": "https://mcp.github.com/sse",
            "auth": {
                "client_id": "Iv1.8a61f9b3a7aba766",
                "client_secret": "1234567890abcdef",
                "scope": "repo read:user"
            }
        }
    }
}
```

## Troubleshooting

### "Invalid redirect URI" Error

This occurs when the callback URL doesn't match registered redirect URIs. Solutions:
- Let mcp-use use Dynamic Client Registration (remove client_id)
- Register your app with one of the supported redirect URIs
- Check if your OAuth provider supports wildcard redirect URIs

### Token Expiration

mcp-use automatically:
- Checks token validity before use
- Refreshes tokens when possible (if refresh_token is available)
- Prompts for re-authentication when tokens expire

### Debugging

Enable debug logging to see OAuth flow details:

```python
import os
os.environ['DEBUG'] = '2'

# Or
from mcp_use import set_debug
set_debug(2)
```

## Security Notes

- Tokens are stored in your home directory with restricted permissions
- Never commit token files to version control
- Client secrets are only needed for confidential clients
- The OAuth flow uses CSRF protection via state parameter
- All callbacks use localhost (127.0.0.1) for security

## Server Support

Servers known to support OAuth with DCR:
- Linear (`https://mcp.linear.app/sse`)
- Asana (`https://mcp.asana.com/sse`)
- Atlassian (`https://mcp.atlassian.com/v1/sse`)

Check your server's documentation for specific OAuth requirements.
